(()=>{"use strict";const t=document.querySelector("#board-1"),e=document.querySelector("#board-2"),r=(r,s,a)=>{t.classList.toggle("active",a===r),e.classList.toggle("active",a===s),t.innerHTML="",e.innerHTML="",[{board:r,element:t},{board:s,element:e}].forEach((({board:t,element:e})=>{const s=[];for(let e=0;e<t[0].length;e++){const r=[];for(let s=0;s<t.length;s++)r.push(t[s][e]);s.push(r)}s.forEach(((s,a)=>{const o=document.createElement("div");o.classList.add("board-column"),e.appendChild(o),s.forEach(((e,s)=>{const i=document.createElement("div");i.classList.add("grid"),i.dataset.y=`${a}`,i.dataset.x=`${s}`,o.appendChild(i),Number.isInteger(e)||t!=r||i.classList.add("ship"),1==e&&i.classList.add("missed"),e[1]&&"x"===e[1].hitMarker&&(i.classList.add("hit"),!0===e[0].status&&i.classList.add("sunk"))}))}))})),console.log(r,s)};class s{constructor(t,e){this.id=t,this.length=e,this.hits=0,this.status=!1}hit(){this.hits+=1}isSunk(){let t=this.hits>=this.length;return!0===t&&(this.status=!0),t}}class a{constructor(){this.board=Array(10).fill(0).map((()=>Array(10).fill(0))),this.ships=[]}isCellEmpty(t,e){return 0===this.board[t][e]}placeShip(t,e,r,a){if("vertical"===a){if(t+r>this.board.length)return!1}else if("horizontal"===a&&e+r>this.board[0].length)return!1;for(let s=0;s<r;s++)if("vertical"===a){if(!this.isCellEmpty(t+s,e))return!1}else if("horizontal"===a&&!this.isCellEmpty(t,e+s))return!1;const o=new s(`ship_${t}_${e}`,r);for(let s=0;s<r;s++)"vertical"===a?this.board[t+s][e]=o:this.board[t][e+s]=o;return this.ships.push(o),this.board}placeShipRandomly(){const t=[5,4,3,3,2];for(let e=0;e<t.length;e++){let r=!1;for(;!r;){let s=Math.floor(10*Math.random()),a=Math.floor(10*Math.random()),o=Math.random()<.5?"vertical":"horizontal";r=this.placeShip(s,a,t[e],o)}}return this.board}recieveAttack(t,e){const r=this.board[t][e];return r instanceof s?(r.hit(),this.board[t][e]=[{...this.board[t][e]},{hitMarker:"x"}],r.isSunk(),!0):(this.board[t][e]=1,!1)}areAllSunk(){return this.ships.every((t=>t.isSunk()))}updateBoardsShips(){let t=this.ships.filter((t=>!0===t.status));if(!t.length)return!1;this.board.forEach((e=>{e.forEach((e=>{t.some((t=>e[0]&&e[0].id===t.id))&&(e[0].status=!0)}))}))}}class o{constructor(t){this.name=t}attackShip(t,e,r){return r.recieveAttack(t,e),r.board}attackRandomly(t){let e=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());return t.recieveAttack(e,r),t.board}}const i=document.querySelector(".start-btn");i.addEventListener("click",(()=>{(()=>{const t=new o("Player 1"),e=new o("Computer"),s=new a,i=new a;s.placeShipRandomly(),i.placeShipRandomly();let l=t,n=i,d=!1;r(s.board,i.board,n.board),document.addEventListener("click",(r=>{if(r.target.closest(".grid")){const s=r.target.closest(".board").id;if(console.log(s),!((l===t&&"board-2"===s)|(l===e&&"board-1"===s)))return void console.log("error");h(r.target.dataset)}}));const h=t=>{let e,r,s=0;for(const a in t)0===s?(r=t[a],s++):1===s&&(e=t[a],s++);c(e,r)},c=(a,o)=>{l.attackShip(a,o,n),n.updateBoardsShips(),s.areAllSunk()||i.areAllSunk()?d=!0:(l=l===t?e:t,n=n===s?i:s),r(s.board,i.board,n.board)}})(),i.disabled=!0}))})();