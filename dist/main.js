(()=>{"use strict";const t=document.querySelector("#board-1"),s=document.querySelector("#board-2"),e=document.querySelector(".title"),r=async e=>{0===e?(t.classList.remove("active"),s.classList.add("active")):1===e&&(s.classList.remove("active"),t.classList.add("active"))},i=t=>{e.innerText="",e.innerText=t},a=(e,r,i)=>{i||(t.classList.add("active"),s.classList.add("active")),t.innerHTML="",s.innerHTML="",[{board:e,element:t},{board:r,element:s}].forEach((({board:t,element:s})=>{const r=[];for(let s=0;s<t[0].length;s++){const e=[];for(let r=0;r<t.length;r++)e.push(t[r][s]);r.push(e)}r.forEach(((r,i)=>{const a=document.createElement("div");a.classList.add("board-column"),s.appendChild(a),r.forEach(((s,r)=>{const o=document.createElement("div");o.classList.add("grid"),o.dataset.y=`${i}`,o.dataset.x=`${r}`,a.appendChild(o),Number.isInteger(s)||t!=e||o.classList.add("ship"),1==s&&o.classList.add("missed"),s[1]&&"x"===s[1].hitMarker&&(o.classList.add("hit"),!0===s[0].status&&o.classList.add("sunk"))}))}))})),console.log(e,r)};class o{constructor(t,s,e){this.id=t,this.length=s,this.isVertical=e,this.hits=0,this.status=!1}hit(){this.hits+=1}isSunk(){let t=this.hits>=this.length;return!0===t&&(this.status=!0),t}getLength(){return this.length}}class n{constructor(){this.board=Array(10).fill(0).map((()=>Array(10).fill(0))),this.ships=[]}isCellEmpty(t,s){return 0===this.board[t][s]}placeShip(t,s,e,r){if(r){if(t+e>this.board.length)return!1}else if(!r&&s+e>this.board[0].length)return!1;for(let i=0;i<e;i++)if(r){if(!this.isCellEmpty(t+i,s))return!1}else if(!r&&!this.isCellEmpty(t,s+i))return!1;const i=new o(`ship_${t}_${s}`,e,r);for(let r=0;r<e;r++)!0===i.isVertical?this.board[t+r][s]=i:this.board[t][s+r]=i;return this.ships.push(i),this.board}placeShipRandomly(){const t=[5,4,3,3,2];for(let s=0;s<t.length;s++){let e=!1;for(;!e;){let r=Math.floor(10*Math.random()),i=Math.floor(10*Math.random()),a=Math.random()<.5;e=this.placeShip(r,i,t[s],a)}}return this.board}recieveAttack(t,s){const e=this.board[t][s];return e instanceof o?(e.hit(),this.board[t][s]=[{...this.board[t][s]},{hitMarker:"x"}],e.isSunk(),!0):(this.board[t][s]=1,!1)}areAllSunk(){return this.ships.every((t=>t.isSunk()))}updateBoardsShips(){let t=this.ships.filter((t=>!0===t.status));if(!t.length)return!1;this.board.forEach((s=>{s.forEach((s=>{t.some((t=>s[0]&&s[0].id===t.id))&&(s[0].status=!0)}))}))}findShip(t,s){return this.ships.find((e=>e.id===this.board[t][s].id))}removeShip(t,s){const e=this.findShip(t,s),r=this.ships.indexOf(e);return-1!==r&&this.ships.splice(r,1),this.board.forEach((t=>{t.forEach(((s,r)=>{s===e&&(t[r]=0)}))})),this.board}moveShip(t,s,e,r){const i=this.findShip(t,s);return this.removeShip(t,s),this.placeShip(e,r,i.getLength(),i.isVertical),this.board}}class h{constructor(t){this.name=t}attackShip(t,s,e){return e.recieveAttack(t,s),e.board}attackRandomly(t){let s=Math.floor(10*Math.random()),e=Math.floor(10*Math.random());return t.recieveAttack(s,e),t.board}}(()=>{const t=new h("Player"),s=new h("Computer"),e=new n,o=new n;let d=!1,l=!1;o.placeShipRandomly(),e.placeShipRandomly(),a(e.board,o.board,d),document.addEventListener("click",(n=>{if(n.target.closest(".start-btn"))return d=!0,r(0),void i("Player's Turn");if(n.target.closest(".grid")&&d){if("board-2"!==n.target.closest(".board").id)return;(async n=>{const{xCoord:h,yCoord:c}=(t=>{let s,e,r=0;for(const i in t)0===r?(e=t[i],r++):1===r&&(s=t[i],r++);return{xCoord:s,yCoord:e}})(n);t.attackShip(h,c,o),o.updateBoardsShips(),r(1),a(e.board,o.board,d),o.areAllSunk()?(i("Player Wins!"),l=!0):(i("Computer's Turn"),await new Promise((t=>setTimeout(t,800))),s.attackRandomly(e),e.updateBoardsShips(),r(0),a(e.board,o.board,d),e.areAllSunk()?(i("Computer Wins!"),l=!0):i("Player's Turn"))})(n.target.dataset)}}))})()})();