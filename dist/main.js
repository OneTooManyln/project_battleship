(()=>{"use strict";const t=document.querySelector("#board-1"),e=document.querySelector("#board-2"),s=(s,r,a)=>{t.classList.toggle("active",a===s),e.classList.toggle("active",a===r),t.innerHTML="",e.innerHTML="",[{board:s,element:t},{board:r,element:e}].forEach((({board:t,element:e})=>{const r=[];for(let e=0;e<t[0].length;e++){const s=[];for(let r=0;r<t.length;r++)s.push(t[r][e]);r.push(s)}r.forEach(((r,a)=>{const o=document.createElement("div");o.classList.add("board-column"),e.appendChild(o),r.forEach(((e,r)=>{const i=document.createElement("div");i.classList.add("grid"),i.dataset.y=`${a}`,i.dataset.x=`${r}`,o.appendChild(i),Number.isInteger(e)||t!=s||i.classList.add("ship"),1==e&&i.classList.add("missed"),e[1]&&"x"===e[1].hitMarker&&(i.classList.add("hit"),!0===e[0].status&&i.classList.add("sunk"))}))}))})),console.log(s,r)};class r{constructor(t,e){this.id=t,this.length=e,this.hits=0,this.status=!1}hit(){this.hits+=1}isSunk(){let t=this.hits>=this.length;return!0===t&&(this.status=!0),t}}class a{constructor(){this.board=Array(10).fill(0).map((()=>Array(10).fill(0))),this.ships=[]}isCellEmpty(t,e){return 0===this.board[t][e]}placeShip(t,e,s,a){if("vertical"===a){if(t+s>this.board.length)return!1}else if("horizontal"===a&&e+s>this.board[0].length)return!1;for(let r=0;r<s;r++)if("vertical"===a){if(!this.isCellEmpty(t+r,e))return!1}else if("horizontal"===a&&!this.isCellEmpty(t,e+r))return!1;const o=new r(`ship_${t}_${e}`,s);for(let r=0;r<s;r++)"vertical"===a?this.board[t+r][e]=o:this.board[t][e+r]=o;return this.ships.push(o),this.board}placeShipRandomly(){const t=[5,4,3,3,2];for(let e=0;e<t.length;e++){let s=!1;for(;!s;){let r=Math.floor(10*Math.random()),a=Math.floor(10*Math.random()),o=Math.random()<.5?"vertical":"horizontal";s=this.placeShip(r,a,t[e],o)}}return this.board}recieveAttack(t,e){const s=this.board[t][e];return s instanceof r?(s.hit(),this.board[t][e]=[{...this.board[t][e]},{hitMarker:"x"}],s.isSunk(),!0):(this.board[t][e]=1,!1)}areAllSunk(){return this.ships.every((t=>t.isSunk()))}updateBoardsShips(){let t=this.ships.filter((t=>!0===t.status));if(!t.length)return!1;this.board.forEach((e=>{e.forEach((e=>{t.some((t=>e[0]&&e[0].id===t.id))&&(e[0].status=!0)}))}))}}class o{constructor(t){this.name=t}attackShip(t,e,s){return s.recieveAttack(t,e),s.board}attackRandomly(t){let e=Math.floor(10*Math.random()),s=Math.floor(10*Math.random());return t.recieveAttack(e,s),t.board}}const i=document.querySelector(".start-btn");i.addEventListener("click",(()=>{(()=>{const t=new o("Player 1"),e=new o("Computer"),r=new a,i=new a;r.placeShipRandomly(),i.placeShipRandomly();let l=t,n=i,d=!1;s(r.board,i.board,n.board),document.addEventListener("click",(async s=>{if(s.target.closest(".grid")){const r=s.target.closest(".board").id;if(console.log(r),l!==t||"board-2"!==r)return void console.log("error");c(s.target.dataset),await new Promise((t=>setTimeout(t,600))),l===e&&(console.log("computers turn"),l.attackRandomly(n),u())}}));const c=t=>{let e,s,r=0;for(const a in t)0===r?(s=t[a],r++):1===r&&(e=t[a],r++);h(e,s)},h=(t,e)=>{l.attackShip(t,e,n),n.updateBoardsShips(),u()},u=()=>{r.areAllSunk()||i.areAllSunk()?(d=!0,console.log(d)):(l=l===t?e:t,n=n===r?i:r),s(r.board,i.board,n.board)}})(),i.disabled=!0}))})();