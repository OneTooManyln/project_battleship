(()=>{"use strict";const t=document.querySelector("#board-1"),s=document.querySelector("#board-2"),e=document.querySelector(".title"),r=async e=>{0===e?(t.classList.remove("active"),s.classList.add("active")):1===e&&(s.classList.remove("active"),t.classList.add("active"))},a=t=>{e.innerText="",e.innerText=t},i=(e,r,a)=>{a||(t.classList.add("active"),s.classList.add("active")),t.innerHTML="",s.innerHTML="",[{board:e,element:t},{board:r,element:s}].forEach((({board:t,element:s})=>{const r=[];for(let s=0;s<t[0].length;s++){const e=[];for(let r=0;r<t.length;r++)e.push(t[r][s]);r.push(e)}r.forEach(((r,a)=>{const i=document.createElement("div");i.classList.add("board-column"),s.appendChild(i),r.forEach(((s,r)=>{const o=document.createElement("div");o.classList.add("grid"),o.dataset.y=`${a}`,o.dataset.x=`${r}`,i.appendChild(o),Number.isInteger(s)||t!=e||o.classList.add("ship"),1==s&&o.classList.add("missed"),s[1]&&"x"===s[1].hitMarker&&(o.classList.add("hit"),!0===s[0].status&&o.classList.add("sunk"))}))}))})),console.log(e,r)};class o{constructor(t,s,e){this.id=t,this.length=s,this.isVertical=e,this.hits=0,this.status=!1}hit(){this.hits+=1}isSunk(){let t=this.hits>=this.length;return!0===t&&(this.status=!0),t}getLength(){return this.length}}class n{constructor(){this.board=Array(10).fill(0).map((()=>Array(10).fill(0))),this.ships=[]}isCellEmpty(t,s){return 0===this.board[t][s]}isPlacementPossible(t,s,e,r){if(r){if(t+e>this.board.length)return!1}else if(!r&&s+e>this.board[0].length)return!1;for(let a=0;a<e;a++)if(r){if(!this.isCellEmpty(t+a,s))return!1}else if(!r&&!this.isCellEmpty(t,s+a))return!1;return!0}placeShip(t,s,e,r){if(!this.isPlacementPossible(t,s,e,r))return!1;const a=new o(`ship_${t}_${s}`,e,r);for(let r=0;r<e;r++)!0===a.isVertical?this.board[t+r][s]=a:this.board[t][s+r]=a;return this.ships.push(a),this.board}placeShipRandomly(){const t=[5,4,3,3,2];for(let s=0;s<t.length;s++){let e=!1;for(;!e;){let r=Math.floor(10*Math.random()),a=Math.floor(10*Math.random()),i=Math.random()<.5;e=this.placeShip(r,a,t[s],i)}}return this.board}recieveAttack(t,s){const e=this.board[t][s];return e instanceof o?(e.hit(),this.board[t][s]=[{...this.board[t][s]},{hitMarker:"x"}],e.isSunk(),!0):(this.board[t][s]=1,!1)}areAllSunk(){return this.ships.every((t=>t.isSunk()))}updateBoardsShips(){let t=this.ships.filter((t=>!0===t.status));if(!t.length)return!1;this.board.forEach((s=>{s.forEach((s=>{t.some((t=>s[0]&&s[0].id===t.id))&&(s[0].status=!0)}))}))}findShip(t,s){return this.ships.find((e=>e.id===this.board[t][s].id))}removeShip(t,s){const e=this.findShip(t,s),r=this.ships.indexOf(e);return-1!==r&&this.ships.splice(r,1),this.board.forEach((t=>{t.forEach(((s,r)=>{s===e&&(t[r]=0)}))})),this.board}moveShip(t,s,e,r){const a=this.findShip(t,s);return this.removeShip(t,s),this.placeShip(e,r,a.getLength(),a.isVertical),this.board}}class d{constructor(t){this.name=t}attackShip(t,s,e){return e.recieveAttack(t,s),e.board}attackRandomly(t){let s=Math.floor(10*Math.random()),e=Math.floor(10*Math.random());return t.recieveAttack(s,e),t.board}}(()=>{const t=new d("Player"),s=new d("Computer"),e=new n,o=new n;let h=!1,l=!1,c=null;o.placeShipRandomly(),e.placeShipRandomly(),i(e.board,o.board,h);const u=t=>{let s,e,r=0;for(const a in t)0===r?(e=t[a],r++):1===r&&(s=t[a],r++);return{xCoord:s,yCoord:e}};document.addEventListener("click",(n=>{if(n.target.closest(".start-btn"))return h=!0,r(0),void a("Player's Turn");if(n.target.closest(".grid")&&h){if("board-2"!==n.target.closest(".board").id)return;(async n=>{const{xCoord:d,yCoord:c}=u(n);t.attackShip(d,c,o),o.updateBoardsShips(),r(1),i(e.board,o.board,h),o.areAllSunk()?(a("Player Wins!"),l=!0):(a("Computer's Turn"),await new Promise((t=>setTimeout(t,800))),s.attackRandomly(e),e.updateBoardsShips(),r(0),i(e.board,o.board,h),e.areAllSunk()?(a("Computer Wins!"),l=!0):a("Player's Turn"))})(n.target.dataset)}else{if(!n.target.closest("#board-1"))return;{const t=n.target.closest(".ship");if(t){const{xCoord:s,yCoord:e}=u(t.dataset);c={x:s,y:e}}else if(c){const{xCoord:t,yCoord:s}=u(n.target.dataset);e.moveShip(c.x,c.y,parseInt(t),parseInt(s)),c=null,i(e.board,o.board,h)}}}}))})()})();